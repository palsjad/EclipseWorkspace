package com.wbl.page;

import java.util.ArrayList;
 import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;

import com.google.common.base.Function;
import com.wbl.helper.ByClass;

public class AmazonSearch {

	WebDriver driver;

	public AmazonSearch(WebDriver driver) {

		this.driver = driver;
	}
	

	
// **********************  allDropDown Method ***************************************************
	
	public String allDropDown(String search) {

		System.out.println("allDropDown");
		
		driver.get("http://www.amazon.com");

		// By byLocator = ByClass.getByObject("xpath-searchDropDown");

		// System.out.println("the by locator is : " + byLocator);

		// search drop down locator
		
		try {
			Thread.sleep(1000);
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		
 	WebElement element = driver.findElement(ByClass.getByObject("xpath-searchDropDown"));
		
	/*	WebDriverWait wait = new WebDriverWait(driver, 25);

		WebElement element = wait.until(
				ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("xpath-searchDropDown")));
*/
		Select sel = new Select(element);

		sel.selectByVisibleText(search); // 'search' comes from the excel file -
											// Clothing, Shoes & Jewelry
/*
	
		List<WebElement> choice = sel.getOptions();

		for (WebElement c : choice) {

			System.out.println("choices : " + c.getText());

		}
		
	*/	

		// ***************** to pause the page so that the page title is read	************************	
		
		

				WebDriverWait wait = new WebDriverWait(driver, 20);

				element = wait.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("css-goToHomePage")));
				
				
				try {
					Thread.sleep(1000);
				} catch (InterruptedException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}

				
		// **************************************************************	
       
		System.out.println("end of allDropDown title is : " + driver.getTitle()); //		 
 
		return driver.getTitle();

		// return choice.size();

	}
	
//***************************************   end of allDropDown Method **********************************************
	
	
//***************************************   dropDownChoice Method ************************************************** 

	public String dropDownChoice(String itm, String person) {
		
		System.out.println("enter dropDownChoice");
		
		WebElement element = driver.findElement(ByClass.getByObject("id-searchbox"));
		element.clear();
		element.sendKeys(itm); // itm comes from the excel file - watches,
								// leather shoes, dresses

		driver.findElement(ByClass.getByObject("xpath-searchSubmit")).click();

		WebDriverWait wait = new WebDriverWait(driver, 40);

		// person comes from ecel file - women, men, girls

		element = wait.until(
				ExpectedConditions.visibilityOfElementLocated(By.xpath(".//a[contains(text(),'" + person + "')]")));

		element.click();
		
		
// ***************** to pause the page so that the page title is read	************************	
		
		

		wait = new WebDriverWait(driver, 20);

		element = wait.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("css-goToHomePage")));
		
		
		try {
			Thread.sleep(1000);
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		
// **************************************************************		

		System.out.println("end of dropDownChoice title is  : " + driver.getTitle());

		return driver.getTitle();

	}
	
//******************************  end of dropDownChoice Method *********************************************
	

	
//**************************************  sortChoice Method ************************************************** 
	
	
	
	public String sortChoice(String prc, String sortType) {

		System.out.println("Enter sortChoice");

		WebDriverWait wait = new WebDriverWait(driver, 35);

		// prc comes from ecel file - index,2 , text,Price: High to Low,
		// text,Price: Low to High
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath(".//span[contains(text(),'" + prc + "')]")))
				.click();

		WebDriverWait expWait = new WebDriverWait(driver, 30);

		WebElement element = expWait
				.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("xpath-sortOptions")));

		Select sel1 = new Select(element);

		List<WebElement> optionsList = sel1.getOptions();

		for (WebElement el : optionsList) {

			System.out.println("price options : " + el.getText());
		}

		String[] sortSplit = sortType.split(",");

		System.out.println("Split string : " + sortSplit[0] + "  " + sortSplit[1]);

		if (sortSplit[0].equals("index")) {

           System.out.println("enter index");
			sel1.selectByIndex(2);
		}

		else if (sortSplit[0].equals("text")) {

	           System.out.println("enter text");

			sel1.selectByVisibleText(sortSplit[1]);
		}

 
		wait = new WebDriverWait(driver, 35);

		String firstPrice = wait.until(func);

		System.out.println("the first price inthe sorted list " + sortType + "   is : " + firstPrice);
		
		
		try {
			Thread.sleep(1000);
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}


		System.out.println("the end of sortChoice title is : " + driver.getTitle());

	/*	System.out.println("Expected title : "
				+ "Amazon.com: Under $25 - Girls / Dresses for Women, Girls & Baby Girls: Clothing, Shoes & Jewelry");
*/
		wait = new WebDriverWait(driver, 30);

	/*	System.out.println("expected title : " + "Amazon.com: Girls - Dresses for Women,"
				+ " Girls & Baby Girls: Clothing, Shoes & Jewelry");
		*/
		
 		return driver.getTitle();

	}
	
//******************************  end of sortChoice Method *********************************************
	

//***************************************   Wait Function  ************************************************** 

	Function<WebDriver, String> func = new Function<WebDriver, String>() {
		public String apply(WebDriver input) {

			
			System.out.println("enter function");
			
			WebDriverWait wait = new WebDriverWait(driver, 25);
			List<WebElement> price = new ArrayList<WebElement>();
			price = wait.until(
					ExpectedConditions.visibilityOfAllElementsLocatedBy(ByClass.getByObject("xpath-sortedPrices")));

			 
            
			for (WebElement p : price) {

				System.out.println(p.getText());
			}

			return price.get(0).getText();

			// Amazon.com: Under $25 - Girls / Dresses for Women, Girls & Baby
			// Girls: Clothing, Shoes & Jewelry
		}

	};
	
//******************************  end of Function ******************************************* 
	
	

//******************************  Search Results *********************************************
	
	
	public String searchResults(String opt) {
		
		System.out.println(" search results test");
		
		System.out.println("opt : " + opt);

		String[] options = opt.split(",");
		String choice = "";
		
		String title = "";
		
		System.out.println("opt 1 : " + options[0] + " " + "opt 2 : " + options[1]);


		WebDriverWait wait = new WebDriverWait(driver, 25);

		if (options[0].equalsIgnoreCase("brand button")) {
			


			choice = options[1];
			
			System.out.println("brand and the option is : " + options[1]);

			
			// driver.findElements(By.xpath(".//span[@class='refinementLink'][text()='Michael Kors']"));

			wait.until(ExpectedConditions 					
 				.visibilityOfElementLocated(By.xpath(".//span[@class='refinementLink'][text()='" + choice + "']")))
 					.click();
			
			
			try {
				Thread.sleep(1000);
			} catch (InterruptedException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}


			title = driver.getTitle();
			
			System.out.println("brand title : " + title);

		}

		else if (options[0].equalsIgnoreCase("page")) {

			System.out.println("page ");

			choice = options[1];

			if (choice.equalsIgnoreCase("Next Page") ) {
				
				System.out.println("next page");

				
				wait.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("id-nextPage"))).click();
				
				 wait = new WebDriverWait(driver, 20);

				
				WebElement element = wait.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("xpath-confirmCurrentPage")));
				
				title = element.getText();
				System.out.println("page title: expecting 2  " + title);


			}

			else {

				System.out.println("number page: ");

				  wait.until(ExpectedConditions.visibilityOfElementLocated(By.linkText(choice))).click(); //choosing by pagenumber from excel file
			
				  WebElement element = wait.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("xpath-confirmCurrentPage")));
					
				  title = element.getText();
					
					System.out.println("page title: expecting 2  " + title);

			
			}

		}

		else if (options[0].equalsIgnoreCase("customer review")) {
			
			System.out.println("customer review");
 
			choice = options[1].trim();
			
			System.out.println("review option " + choice);

			   
			List<WebElement> reviews = new ArrayList<WebElement>();
			
			wait = new WebDriverWait(driver,45);
			
			reviews = wait.until(ExpectedConditions.visibilityOfAllElementsLocatedBy(ByClass.getByObject("xpath-listForCustReviewsX")));
			String text = "";
			for( int i = 0; i < reviews.size(); i ++) {
 				text = reviews.get(i).getText();
 				System.out.println("the reviews are : " + text );
			}
			
			int val = 0;
			  val = Integer.parseInt(choice);
			
			for(WebElement ele : reviews) {
				
				switch (val) {
				case   4 :  
			    	if(ele.getText().equals("4 Stars & Up")) {
						System.out.println("4 stars");

					 ele.click();
			    	}
			    	break;
				case   3:  
			    	if(ele.getText().equals("3 Stars & Up")) {
					
					 ele.click();
			    	}
			    	break;
				case   2:  
			    	if(ele.getText().equals("2 Stars & Up")) {
					
					 ele.click();
			    	}
			    	break;
				case   1:  
			    	if(ele.getText().equals("1 Star & Up")) {
					
					 ele.click();
			    	}
			    	break;
			    				
			    	 
				}
				
				 
						
		//		this is the list insted to choose 		.//*[@id='ref_2661617011']
			}
			
			title = driver.getTitle();
			
			System.out.println("title   " + title);


		}

		return title;

	}
	
	//******************************  end of Search Results *********************************************
	

}
