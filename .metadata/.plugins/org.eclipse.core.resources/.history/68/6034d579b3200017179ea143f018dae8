package com.wbl.page;

import java.util.ArrayList;
import java.util.List;

import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

import com.wbl.helper.ByClass;

public class AmazonHomePage {

	WebDriver driver;

	public AmazonHomePage(WebDriver driver) {
		System.out.println("amazon home page constructor");

		this.driver = driver;
	}

	// ****************************** create account **************************************************

	public AmazonLoginPage createAccountPage() {

		WebDriverWait wait = new WebDriverWait(driver, 30);

		wait.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("xpath-AccountLink"))).click();

		WebElement element = wait
				.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("xpath-AccountSubmit")));

		element.click();

	//	return driver.getTitle();

	  return new AmazonLoginPage(driver);

	}

	// ****************************** end of create account *************************************

	// ****************************** sign in **************************************************

	public AmazonLoginPage getSignInPage() {

		WebDriverWait wait = new WebDriverWait(driver, 30);

		wait.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("xpath-AccountLink"))).click();

		// return driver.getTitle();

		return new AmazonLoginPage(driver);

	}

	// ****************************** end of sign in **************************************************

	// ****************************Department drop down count **************************************************

	public int getDeptDropDownCount() {

		WebDriverWait wait = new WebDriverWait(driver, 25);

		List<WebElement> dropDownList = new ArrayList<WebElement>();

		Actions action = new Actions(driver);

		WebElement dropDown = wait
				.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("css-deptLinkHover")));

		action.moveToElement(dropDown).perform();

		dropDownList = wait.until(
				ExpectedConditions.visibilityOfAllElementsLocatedBy(ByClass.getByObject("xpath-countDropDownPanel")));

		return dropDownList.size();

	}

	// ****************************end of Department drop down count **************************************************

	// ****************************navigate department drop down **************************************************

	public String navigateDeptDropDown(String firstChoice, String secondChoice) {

		WebDriverWait wait = new WebDriverWait(driver, 40);

		Actions action = new Actions(driver);

		WebElement dropDown = wait
				.until(ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("xpath-deptLinkClick")));

		action.moveToElement(dropDown).perform();

		wait = new WebDriverWait(driver, 30);

		WebElement nav = wait.until(ExpectedConditions
				.visibilityOfElementLocated(ByClass.getByObject("xpath-bookPanelOnDropDownHover", firstChoice, "']")));

		action.moveToElement(nav).perform();

		wait = new WebDriverWait(driver, 30);

		wait.until(ExpectedConditions
				.visibilityOfElementLocated(ByClass.getByObject("xpath-clickOnChildrensBooks", secondChoice, "')]")))
				.click();

		return driver.getTitle();

	}

	// ****************************end of navigate department drop down *************************************

	// **************************** accounts and list choices **********************************************

	public String getAccountDetails(String listChoice) {

		String[] opts = listChoice.split(",");

		String choice = opts[0].trim();
		String type = opts[1].trim();

		try {
			Thread.sleep(2000);
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		driver.get("http://www.amazon.com");

		WebDriverWait wait = new WebDriverWait(driver, 25);

		Actions action = new Actions(driver);

		List<WebElement> acc = new ArrayList<WebElement>();

		// *********to click on Account and lists **********************

		acc = wait
				.until(ExpectedConditions.visibilityOfAllElementsLocatedBy(ByClass.getByObject("css-headerLinkList")));

		for (WebElement ele : acc) {

			if (ele.getText().equals("Account & Lists")) {

				System.out.println("header list : " + ele.getText());

				action.moveToElement(ele).perform();
				break;
			}

		}

		wait = new WebDriverWait(driver, 30);

		if (type.equals("list")) {
			wait.until(
					ExpectedConditions.visibilityOfElementLocated(ByClass.getByObject("xpath-listSearch", choice, "]")))
					.click();

		} else if (type.equals("account")) {
			wait.until(ExpectedConditions
					.visibilityOfElementLocated(ByClass.getByObject("xpath-accountSearch", choice, "]"))).click();
		}

		try {
			Thread.sleep(2000);
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		return driver.getTitle();
	}

	// **************************** end of accounts and list choices **********************************************

}
